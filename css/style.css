/* === AI 維護總則（Read-first, Do-not-delete） ===
 * 目的：杜絕「跨畫面誤刪/誤改」與樣式膨脹，確保結果一致。
 * 通用守則：
 * - 追加式覆蓋：只在對應畫面命名空間內（例如 `#talent-select-screen`）追加樣式；禁止改動/刪除既有區塊。
 * - 嚴禁刪除：切勿刪除天賦介面任何樣式（`#talent-select-screen`、`.talent-grid`、`.char-card`、`.char-card-wrap`）。
 * - 嚴禁全域覆蓋：避免直接更動通用類（如 `.char-grid`、`.talent-grid`、`.select-card`、`.top-left-icon-btn`），若需變更請於父畫面選擇器命名空間下覆蓋。
 * - 不改文字/文案：本檔僅限視覺；任何文字、鍵名、資料結構、加密簽章（SaveCode）均不得更動。
 * - SaveCode 安全：CSS 不涉存檔邏輯；若需求可能影響存檔呈現，請先設計升版與向下相容，並由 JS 處理，CSS 僅視覺跟隨。
 * - 高風險清單：
 *   • 天賦：`#talent-select-screen`、`.talent-grid`、`.char-card`、`.char-card-wrap`
 *   • 選角：`#character-select-screen`、`.char-grid`
 *   • 升級：`#level-up-menu`、`.upgrade-option`（僅覆蓋 `#level-up-menu .upgrade-option`）
 *   • 選圖/難度：`.select-card`、`.map-grid`、`.diff-grid`
 *   • 通用圖示：`.top-left-icon-btn`
 * - 變更策略：優先在命名空間中新增小範圍覆蓋，禁止搬移/合併跨區塊樣式。
 * - 自檢流程：改動後需自我檢查是否可能影響其他畫面；若有疑慮，立即回退並改用更高優先度、較小範圍的覆蓋。
 * - 註解不可移除：以下各區塊的「ANCHOR」註解為防誤刪護欄，請保留。
 */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    /* 遊戲UI縮放（由JS設置），用於在手機上自適應元素尺寸 */
    --ui-scale: 1;

    /*
     維護指南（CSS變數與基礎樣式）
     - 目的：以共用變數抽象重覆的背景、邊框與陰影，避免樣式膨脹與覆蓋錯誤。
     - 使用範例：
       • 背景遮罩：使用 `var(--overlay-grad)` 套在整頁背景（start/character/talent）。
       • 面板背景：使用 `var(--panel-bg)`（或 `var(--panel-grad)` 作卡片漸層），搭配 `var(--border-soft)` 與 `var(--shadow-lg)`。
       • 霧化：統一使用 `backdrop-filter: blur(var(--blur-6))`。
     - 新增頁面時：先選擇對應「基礎面板」類型（dialog/panel/card），再以小範圍覆蓋，不要複製整段樣式。
     - RWD：盡量沿用既有斷點（900/700/480px），同一模組的RWD集中於一處，避免跨檔重覆。
     */
    /* 共用色彩/材質變數：避免重複定義導致樣式膨脹 */
    --overlay-grad: linear-gradient(180deg, rgba(0,0,0,0.65) 0%, rgba(0,0,0,0.5) 50%, rgba(0,0,0,0.65) 100%);
    --panel-grad: linear-gradient(180deg, rgba(10,20,30,0.75) 0%, rgba(10,20,30,0.7) 50%, rgba(10,20,30,0.75) 100%);
    --panel-bg: rgba(20, 30, 40, 0.92);
    --border-soft: 1px solid rgba(255,255,255,0.12);
    --card-border: 1px solid rgba(255,255,255,0.15);
    --shadow-lg: 0 12px 30px rgba(0,0,0,0.5);
    --blur-6: 6px;
}

body {
    font-family: Arial, sans-serif;
    background-color: #000;
    color: #fff;
    overflow: hidden;
}

#game-container {
    position: relative;
    width: 100vw;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
}

.screen {
    position: absolute;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 10;
}

/* 全域隱藏規則：任何元素套用 .hidden 皆強制不顯示 */
.hidden {
    display: none !important;
}

#start-screen {
    background: #000;
    overflow: hidden;
}

/* 開始畫面背景（16:9） */
.start-bg {
    position: absolute;
    inset: 0;
    /* 將開始介面背景改為 background2.jpg，暫時關閉 background2/3 通道 */
    background: url('../assets/images/background2.jpg') center/cover no-repeat;
    filter: blur(2px) brightness(0.9) saturate(1.1);
}

/* 開始畫面遮罩：共用漸層避免重複定義 */
.start-overlay {
    position: absolute;
    inset: 0;
    background: var(--overlay-grad);
}

.start-card {
    position: relative;
    width: min(900px, 92vw);
    max-height: 92vh;
    padding: 24px;
    border-radius: 12px;
    background: linear-gradient(rgba(20,20,20,0.50), rgba(20,20,20,0.65)), url('../assets/images/Background3.jpg') center/cover no-repeat, url('../assets/images/background3.jpg') center/cover no-repeat;
    box-shadow: 0 12px 40px rgba(0,0,0,0.6);
    backdrop-filter: blur(6px);
    overflow: auto;
}

.start-header h1 {
    font-size: clamp(28px, 5vw, 42px);
    margin-bottom: 8px;
    color: #ff4757;
    text-shadow: 0 0 10px rgba(255,71,87,0.4);
}

.start-header .subtitle {
    font-size: clamp(14px, 2.5vw, 18px);
    color: #ddd;
}

.start-actions {
    margin: 16px 0 24px;
}

.start-actions .primary {
    padding: 12px 24px;
    font-size: clamp(16px, 3.5vw, 20px);
    background: linear-gradient(135deg, #ff4757, #ff6b81);
    color: #fff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: transform .2s ease, box-shadow .2s ease;
}

.start-actions .primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(255,107,129,0.4);
}

.settings {
    border-top: 1px solid rgba(255,255,255,0.08);
    padding-top: 16px;
}

.settings h2 {
    font-size: clamp(18px, 3vw, 22px);
    margin-bottom: 12px;
}

.volume-row {
    display: grid;
    grid-template-columns: 80px 1fr 50px;
    gap: 12px;
    align-items: center;
    margin-bottom: 10px;
}

.volume-row input[type="range"] {
    width: 100%;
}

.volume-row .ghost {
    padding: 8px 12px;
    font-size: 14px;
    background: transparent;
    color: #fff;
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 6px;
    cursor: pointer;
}

.info details {
    margin-top: 12px;
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 8px;
    overflow: hidden;
}

.info summary {
    background: rgba(255,255,255,0.06);
    padding: 10px 12px;
    cursor: pointer;
}

.info .content {
    padding: 12px;
}

.info .regarding ul {
    padding-left: 18px;
}

@media (max-width: 640px) {
    .start-card {
        width: 95vw;
        padding: 16px;
    }
    .volume-row {
        grid-template-columns: 70px 1fr 40px;
        gap: 8px;
    }
}

/* 視窗內的等比縮放容器 */
#viewport {
    position: relative;
    width: 1280px;
    height: 720px;
    display: block;
}

/* 畫布填滿viewport（內部解析度仍為800x600） */
#game-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
    image-rendering: pixelated;
}

/* UI覆蓋在viewport之上，元素絕對定位到角落 */
#game-ui {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 2;
    pointer-events: none;
}

#health-bar-container, #exp-bar-container, #energy-bar-container {
    display: flex;
    align-items: center;
    margin-bottom: 5px;
}

.ui-label {
    font-weight: bold;
    margin-right: 5px;
}

#health-bar, #exp-bar, #energy-bar {
    width: 200px;
    height: 20px;
    background-color: #333;
    border: 2px solid #fff;
    border-radius: 10px;
    overflow: hidden;
    margin-right: 5px;
}

#health-fill {
    height: 100%;
    background-color: #ff0000;
    width: 100%;
    transition: width 0.3s;
}

#exp-fill {
    height: 100%;
    background-color: #00ff00;
    width: 0%;
    transition: width 0.3s;
}

#energy-fill {
    height: 100%;
    background-color: #00bfff;
    width: 0%;
    transition: width 0.3s;
}

#level-info {
    position: absolute;
    top: 10px;
    left: 120px;
    display: flex;
    align-items: center;
}

#level-text, #health-text, #exp-text, #energy-text {
    font-weight: bold;
}

#timer {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 1.5rem;
    font-weight: bold;
}

#wave-info {
    position: absolute;
    top: 40px;
    right: 10px;
    font-size: 1.2rem;
}

/* 金幣顯示（右上角，在wave-info下方） */
#coins-display {
    position: absolute;
    top: 70px;
    right: 10px;
    display: flex;
    align-items: center;
    font-size: 1.1rem;
    font-weight: bold;
    color: #ffd700;
    text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
}

#coins-icon {
    width: 24px;
    height: 24px;
    margin-right: 6px;
}

/* 左上角的HP與EXP條依序排列在Level下方 */
#health-bar-container {
    position: absolute;
    top: 40px;
    left: 120px;
}

#exp-bar-container {
    position: absolute;
    top: 70px;
    left: 120px;
}

#energy-bar-container {
    position: absolute;
    top: 100px;
    left: 120px;
}

/* 手機響應式調整：縮小字體與血條尺寸，避免遮擋 */
@media (max-width: 600px) {
    #level-info { font-size: 0.85rem; top: 6px; left: 58px; }
    #timer { font-size: 1rem; top: 6px; }
    #wave-info { font-size: 0.9rem; top: 24px; }
    #coins-display { font-size: 0.9rem; top: 42px; }
    #coins-icon { width: 18px; height: 18px; margin-right: 4px; }
    #health-bar, #exp-bar, #energy-bar { width: 100px; height: 9px; border-width: 1px; }
    #health-text, #exp-text, #energy-text { font-size: 0.78rem; margin-left: 4px; }
    .ui-label { display: none; }
    #health-bar-container { top: 10px; left: 58px; }
    #exp-bar-container { top: 24px; left: 58px; }
    #energy-bar-container { top: 38px; left: 58px; }
    #player-avatar { width: 44px; height: 44px; top: 6px; left: 6px; }
}

@media (max-width: 400px) {
    #level-info { font-size: 0.75rem; top: 4px; left: 50px; }
    #timer { font-size: 0.9rem; top: 4px; }
    #wave-info { font-size: 0.8rem; top: 20px; }
    #coins-display { font-size: 0.8rem; top: 36px; }
    #coins-icon { width: 16px; height: 16px; margin-right: 3px; }
    #health-bar, #exp-bar, #energy-bar { width: 80px; height: 7px; }
    #health-text, #exp-text, #energy-text { font-size: 0.7rem; }
    #health-bar-container { top: 8px; left: 58px; }
    #exp-bar-container { top: 20px; left: 50px; }
    #energy-bar-container { top: 32px; left: 50px; }
    #player-avatar { width: 38px; height: 38px; top: 6px; left: 6px; }
}

/* ANCHOR: LEVEL-UP-MENU — 僅限升級視窗（不要動全域 `.upgrade-option`）
 * - 視覺覆蓋策略：若調整卡片樣式，請使用 `#level-up-menu .upgrade-option` 以免影響其他介面。
 * - 保持行為一致：欄位大小與位置不變，僅修改內部視覺；禁止改動 `lum-` 相關容器結構。
 * - 不改文字/數值：升級選項文案、數值展示不可更動；本區僅視覺優化。
 * - SaveCode 不動：升級視窗僅UI；不得影響存檔的鍵名、結構或簽章。
 */
#level-up-menu {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgba(0, 0, 0, 0.6); /* 底層更透明（原0.9） */
    padding: 20px;
    border-radius: 10px;
    border: 2px solid #ff0000;
    z-index: 100;
    text-align: center;
    /* Sidebar offset var：往下移避免擋臉，之後可自行微調 */
    --lum-sidebar-offset-top: 248px; /* 原 148px → 下移 100px */
    /* Header & layout offsets：允許微調標題位置與上邊距，避免壓到右側卡片 */
    --lum-header-left: 100px; /* 再往左微調 */
    --lum-header-top: 34px;  /* 再往下微調 */
    --lum-columns-top: 8px;
}

#level-up-menu h2 {
    /* 絕對定位：移至立繪髮頂區域（參考圖） */
    position: absolute;
    top: var(--lum-header-top, 34px);
    left: var(--lum-header-left, 100px);
    margin: 0;
    font-size: 2.15rem;
    letter-spacing: 0.6px;
    text-align: left;
    z-index: 3;
    /* 金光特效：金色漸層 + 柔和光暈 */
    background-image: linear-gradient(180deg, #ffe28a, #ffd15a 60%, #f7a53e);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    /* 黑框描邊（主要瀏覽器支援） */
    -webkit-text-stroke: 1.5px rgba(0, 0, 0, 0.85);
    /* 金光陰影 */
    text-shadow: 0 0 8px rgba(255, 208, 80, 0.55), 0 0 16px rgba(255, 180, 60, 0.35);
    animation: lumGoldPulse 2.8s ease-in-out infinite;
}
@keyframes lumGoldPulse {
  0%, 100% {
    text-shadow: 0 0 6px rgba(255, 208, 80, 0.45), 0 0 12px rgba(255, 180, 60, 0.25);
  }
  50% {
    text-shadow: 0 0 10px rgba(255, 228, 120, 0.70), 0 0 20px rgba(255, 200, 90, 0.45);
  }
}

/* === Upgrade Menu: Sidebar & Background (namespaced under #level-up-menu) === */
#level-up-menu .lum-bg {
  position: absolute;
  top: 8px; bottom: 8px; left: 8px;
  width: 520px; /* 原360px → 放大，避免屬性欄遮到臉 */
  background-position: -33px calc(50% - 13px); /* 垂直上移10px；調整此值可微調上下與左右 */
  background-repeat: no-repeat;
  background-size: contain; /* 立繪以等比縮放，避免裁切 */
  opacity: 0.90; /* 立繪調整透明度 */
  filter: brightness(1.05) saturate(1.1);
  pointer-events: none;
}
#level-up-menu .lum-bg::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(to right, rgba(0,0,0,0) 65%, rgba(0,0,0,0.35) 100%);
  pointer-events: none;
}
/* 只保留 .lum-columns 相對定位；h2 改為絕對定位 */
#level-up-menu .lum-columns { position: relative; z-index: 1; }
#level-up-menu .lum-columns {
  display: grid;
  grid-template-columns: 300px 500px; /* 左側固定300px，右側固定 540px */
  gap: 20px; /* 左右距離再加大 */
  align-items: start;
  margin-top: var(--lum-columns-top, 8px); /* 選項上移（減少標題占位） */
}
#level-up-menu .lum-sidebar {
  /* 保持位置與寬度不變；改為兩欄網格以降低高度與空洞感 */
  display: grid; /* 原為 flex-column */
  grid-template-columns: 1fr 1fr; /* 兩欄分佈 */
  column-gap: 16px;
  row-gap: 6px;
  padding: 9px 12px; /* 輕度壓縮內距 */
  margin-top: var(--lum-sidebar-offset-top); /* 由變數控制，可微調 */
  background: rgba(15, 20, 28, 0.70);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 8px;
  backdrop-filter: blur(3px);
}
#level-up-menu .lum-sidebar .stat-row {
  display: flex;
  align-items: center;
  justify-content: space-between; /* 每格內維持「標籤左、數值右」 */
  color: #cfe7ff;
  font-size: 1.04rem; /* 字級微降，縮短整體高度 */
  line-height: 1.16; /* 降低行高，避免過多空白 */
  padding: 2px 0; /* 每列上下縮2px */
}
/* 置頂：HP 橫跨兩欄；DEF 移到右下角（row 4, col 2），以填滿最後一行、縮短整體高度 */
#level-up-menu .lum-sidebar .stat-row:nth-child(1) { grid-column: 1 / -1; }
#level-up-menu .lum-sidebar .stat-row:nth-child(2) { grid-column: 2; grid-row: 4; }
#level-up-menu .lum-sidebar .stat-label { color: #9ed0ff; letter-spacing: 0.4px; }
#level-up-menu .lum-sidebar .stat-value { color: #fff; font-weight: 700; }

/* Visual-only: Left stats panel row styling (no size/position changes) */
#level-up-menu .lum-sidebar .stat-row { position: relative; --accent: #a0bff2; }
#level-up-menu .lum-sidebar .stat-row::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: 6px;
  background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
  border: 1px solid rgba(255,255,255,0.08);
  pointer-events: none;
}
#level-up-menu .lum-sidebar .stat-row:hover::before { filter: brightness(1.05); }
#level-up-menu .lum-sidebar .stat-row::after {
  content: '';
  position: absolute;
  left: 6px;
  top: 50%;
  transform: translateY(-50%);
  width: 8px; height: 8px;
  border-radius: 50%;
  background: var(--accent);
  box-shadow: 0 0 10px var(--accent);
  opacity: 0.85;
}
#level-up-menu .lum-sidebar .stat-label { margin-left: 16px; }
#level-up-menu .lum-sidebar .stat-value {
  padding: 2px 8px;
  border-radius: 6px;
  background: rgba(255,255,255,0.04);
  box-shadow: 0 0 0 1px var(--accent) inset;
}
/* Row accent colors by order (HP, DEF, ATK, SPD, CRT, Pickup, Haste) */
#level-up-menu .lum-sidebar .stat-row:nth-child(1) { --accent: #ff5b5b; }
#level-up-menu .lum-sidebar .stat-row:nth-child(2) { --accent: #5cc8ff; }
#level-up-menu .lum-sidebar .stat-row:nth-child(3) { --accent: #ffb25c; }
#level-up-menu .lum-sidebar .stat-row:nth-child(4) { --accent: #ffd166; }
#level-up-menu .lum-sidebar .stat-row:nth-child(5) { --accent: #c07cff; }
#level-up-menu .lum-sidebar .stat-row:nth-child(6) { --accent: #73d58f; }
#level-up-menu .lum-sidebar .stat-row:nth-child(7) { --accent: #6fb7ff; }

/* 手機版：維持單欄堆疊，避免擠壓字型與行距 */
@media (max-width: 700px) {
  #level-up-menu .lum-sidebar { display: flex; flex-direction: column; gap: 6px; padding: 9px 12px; }
  #level-up-menu .lum-sidebar .stat-row:nth-child(1),
  #level-up-menu .lum-sidebar .stat-row:nth-child(2) { grid-column: auto; }
}
#level-up-menu .lum-options { position: relative; }

/* 底部動作列：重抽 / 換一個 / 保留（純UI；不更動數值與存檔） */
#level-up-menu .lum-actions {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 8px;
}
#level-up-menu .lum-actions .action-btn {
  flex: 1 1 auto;
  padding: 8px 12px;
  font-size: 0.95rem;
  letter-spacing: 0.4px;
  color: #dfe9ff;
  background: rgba(25,28,36,0.75);
  border: 1px solid rgba(160,191,242,0.55);
  border-radius: 6px;
  cursor: pointer;
  transition: filter .15s ease, border-color .15s ease, transform .15s ease;
}
#level-up-menu .lum-actions .action-btn:hover {
  filter: brightness(1.08);
  transform: translateY(-1px);
}
#level-up-menu .lum-actions .action-btn[disabled] {
  opacity: 0.5;
  cursor: not-allowed;
  filter: none;
}
/* 色系 */
#level-up-menu .lum-actions .action-btn--reroll { border-color: #a0bff2; }
#level-up-menu .lum-actions .action-btn--replace { border-color: #e5b65e; }
#level-up-menu .lum-actions .action-btn--hold { border-color: #9ed0ff; }

@media (max-width: 700px) {
  #level-up-menu .lum-columns { grid-template-columns: 1fr; gap: 10px; }
  #level-up-menu .lum-bg { left: 0; width: 45%; opacity: 0.18; } /* 手機保留偏左效果 */
}

/* === Upgrade Menu: Card layout & icons (visual-only; override, no text changes) === */
/*
 * 維護備註：
 * 此區樣式僅針對 `#level-up-menu` 內的升級選項，使用更高優先度選擇器覆蓋原`.upgrade-option`樣式。
 * 目標：實現卡片式排版與圖示視覺，但不影響遊戲內任何文字、行為與數值。
 * 任何修改應限定在此命名空間內，避免影響其他遊戲介面（例如天賦、選角、選地圖等）。
 * 若要調整卡片間距、尺寸、顏色，請直接修改此處屬性，確保排版與功能「結果一致」。
 */
#level-up-menu #upgrade-options {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  gap: 10px; /* 卡片間距微調 */
  width: 100%; /* 跟隨右欄寬度（540px） */
  margin: 0; /* 右側改為靠左對齊 */
}

#level-up-menu .upgrade-option {
  position: relative; /* 確保標籤絕對定位以卡片為參考 */
  display: flex;
  align-items: center;
  gap: 12px;
  width: 100%;
  max-width: 760px;
  padding: 8px 10px; /* 微調內距 */
  border-radius: 6px; /* 微調圓角 */
  background: linear-gradient(180deg, rgba(30,30,30,0.88), rgba(24,24,24,0.88)); /* 卡片更透明 */
  border: 2px solid #a0bff2; /* 主色邊框 */
  cursor: pointer;
  transition: background-color .15s ease, border-color .15s ease;
}

/* 分類標籤：右上角顯示 >> StatUp/Skill/Weapon（純視覺，不影響文案） */
#level-up-menu .upgrade-option .uop-tag {
  position: absolute;
  top: 6px;
  right: 12px;
  font-size: 0.85rem;
  color: #a0bff2; /* 主色 */
  opacity: 0.9; /* 稍微提高不透明度 */
  letter-spacing: 0.5px;
  white-space: nowrap; /* 避免換行重疊 */
  z-index: 1;
  pointer-events: none;
}
#level-up-menu .upgrade-option:hover {
  background-color: rgba(50,50,50,0.9); /* 懸停背景微調 */
  border-color: #cfe3ff; /* 懸停邊框亮度 */
  transform: scale(1.01); /* 將縮放幅度調小，覆蓋全域 1.05 */
}

/* 單擊高亮（待確認）：箭頭 + 亮框 */
#level-up-menu .upgrade-option.uop-pending {
  border-color: #a0bff2;
  box-shadow: 0 0 0 2px rgba(160,191,242,0.45) inset, 0 0 10px rgba(160,191,242,0.35);
  transform: scale(1.005);
}
#level-up-menu .upgrade-option.uop-pending::before {
  content: '';
  position: absolute;
  left: -18px; /* 箭頭在卡片左外側 */
  top: 50%;
  transform: translateY(-50%);
  width: 0; height: 0;
  border-top: 8px solid transparent;
  border-bottom: 8px solid transparent;
  border-right: 16px solid #a0bff2; /* 箭頭顏色 */
}
/* 保留標記（不影響文案與行為）：在卡片左上角顯示標籤 */
#level-up-menu .upgrade-option.uop-held::after {
  content: '保留';
  position: absolute;
  left: 8px; top: 8px;
  font-size: 0.75rem;
  color: #ffd8a0;
  background: rgba(40,30,15,0.6);
  border: 1px solid rgba(255,216,160,0.65);
  border-radius: 3px;
  padding: 1px 6px;
}

#level-up-menu .upgrade-option .uop-icon {
  flex: 0 0 auto;
  width: 56px; /* 圖示尺寸微調 */
  height: 56px; /* 圖示尺寸微調 */
  border: 1px solid rgba(255,255,255,0.2); /* 圖示邊框微調 */
  border-radius: 4px; /* 圖示圓角微調 */
  display:flex;
  align-items:center;
  justify-content:center;
  background: rgba(0,0,0,0.65); /* 圖示背景微調 */
}
#level-up-menu .upgrade-option .uop-icon img {
  width: 90%; /* 圖示圖片微縮 */
  height: 90%; /* 圖示圖片微縮 */
  object-fit: contain;
  image-rendering: pixelated;
  display:block;
}

#level-up-menu .upgrade-option .uop-text {
  flex: 1 1 auto;
  text-align: left;
  padding-right: 56px; /* 預留右上標籤空間，避免文字重疊 */
}
#level-up-menu .upgrade-option .uop-text h3 {
  margin: 0 0 4px; /* 標題間距微調 */
  font-size: 1.05rem;
  color: #a0bff2; /* 套用主色 */
  line-height: 1.2;
}
#level-up-menu .upgrade-option .uop-text p {
  margin: 0;
  font-size: 0.9rem; /* 描述文字尺寸微調 */
  line-height: 1.3;
  color: #a0a0a0; /* 描述文字顏色微調 */
  display: -webkit-box;
  -webkit-line-clamp: 2; /* 限制為兩行 */
  -webkit-box-orient: vertical;
  overflow: hidden;
}

@media (max-width: 520px) {
  #level-up-menu .upgrade-option { padding: 6px 8px; gap: 8px; }
  #level-up-menu .upgrade-option .uop-icon { width: 48px; height: 48px; }
  #level-up-menu .upgrade-option .uop-text h3 { font-size: 0.95rem; }
  #level-up-menu .upgrade-option .uop-text p { font-size: 0.85rem; }
}
.upgrade-option {
    background-color: #333;
    border: 2px solid #ff0000;
    border-radius: 5px;
    padding: 10px;
    width: 150px;
    cursor: pointer;
    transition: all 0.3s;
}

.upgrade-option:hover {
    background-color: #555;
    transform: scale(1.05);
}

.upgrade-option h3 {
    font-size: 1.2rem;
    margin-bottom: 5px;
    color: #ff0000;
}

.upgrade-option p {
    font-size: 0.9rem;
}

#game-over-screen, #victory-screen {
    background-color: #000;
    position: absolute;
    top: 0;
    left: 0;
}

#game-over-video, #victory-video {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: block;
}

/* 視頻覆蓋層：用於要求使用者手勢播放以恢復聲音 */
.video-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 20;
}
.video-overlay.hidden { display: none; }
.video-overlay-content { text-align: center; color: #fff; }
.video-overlay .primary { padding: 10px 20px; }

/* 選角介面 */

/* Character select screen overrides: 6 columns square grid, image fill, hide names */
#character-select-screen .char-grid {
  grid-template-columns: repeat(6, minmax(0, 1fr));
  grid-auto-rows: auto;
  justify-items: stretch;
}
#character-select-screen .char-card,
#character-select-screen .char-slot {
  aspect-ratio: 1 / 1;
  padding: 0;
  overflow: hidden;
}
#character-select-screen .char-card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  image-rendering: pixelated;
  display: block;
}
#character-select-screen .char-name { display: none; }

@media (max-width: 900px) {
  #character-select-screen .char-grid { grid-template-columns: repeat(4, minmax(0, 1fr)); }
}
@media (max-width: 700px) {
  #character-select-screen .char-grid { grid-template-columns: repeat(3, minmax(0, 1fr)); }
}
@media (max-width: 480px) {
  /* 手機視覺：每行改為4格（不影響PC） */
  #character-select-screen .char-grid { grid-template-columns: repeat(4, minmax(0, 1fr)); }
}
/* 角色選擇畫面背景：使用共用遮罩漸層搭配 background2.jpg */
/* ANCHOR: CHARACTER-SELECT — 命名空間限定（禁止跨畫面覆蓋）
 * - 僅於 `#character-select-screen` 內調整；通用 `.char-grid` 變更請以父選擇器覆蓋，不得全域改動。
 * - 不改文字：角色名稱、提示、確認對話文案不可更動。
 * - RWD 一致：維持既有斷點（900/700/480px）；如需微調，請在本命名空間內覆蓋。
 */
#character-select-screen {
    background:
        var(--overlay-grad),
        url('../assets/images/background2.jpg') center/cover no-repeat;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
    touch-action: pan-y;
}
/* 內框（char-card-wrap）：半透明面板疊加兩層底圖，含陰影與模糊 */
.char-card-wrap { width: min(1100px, 92vw); max-height: 92vh; overflow: auto; padding: 20px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); backdrop-filter: blur(6px); background:
  var(--panel-grad),
  url('../assets/images/Background3.jpg') center/cover no-repeat,
  url('../assets/images/background3.jpg') center/cover no-repeat;
}
.char-title { font-size: clamp(26px, 4vw, 40px); letter-spacing: 1px; margin-bottom: 8px; text-align: center; background: rgba(128,128,128,0.35); border-radius: 10px; padding: 8px 12px; display: block; width: fit-content; margin: 0 auto 8px; }
.char-subtitle { color: #cfe7ff; margin-bottom: 16px; text-align: center; background: rgba(128,128,128,0.25); border-radius: 8px; padding: 6px 10px; display: block; width: fit-content; margin: 0 auto 16px; }
/* ANCHOR: CHAR-GRID — 通用角色網格（命名空間覆蓋，少改通用）
 * - 僅於 `#character-select-screen .char-grid` 或父命名空間做差異覆蓋。
 * - 不改文字：角色名稱與相關文案不可更動。
 */
/* 上方格子，固定10格置中 */
.char-grid { display: grid; grid-template-columns: repeat(5, minmax(160px, 1fr)); grid-auto-rows: 160px; gap: 14px; justify-items: center; }
.char-card, .char-slot { width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)); border: 1px solid rgba(255,255,255,0.15); border-radius: 10px; padding: 12px; color: #fff; }
.char-card.selectable { cursor: pointer; transition: transform .15s ease, box-shadow .15s ease; }
.char-card img { width: 96px; height: 96px; image-rendering: pixelated; }
.char-card.selectable:hover { transform: translateY(-2px); box-shadow: 0 8px 18px rgba(0,0,0,0.4); }
.char-name { font-weight: 700; }
.char-slot.empty { opacity: 0.25; border-style: dashed; }

/* 下方預覽區 */
/* 下方預覽區 */
/* 重複定義移除：選角預覽與其RWD尾端版本，保留前段唯一版本 */

/* 左上角玩家頭像 */
#player-avatar {
    position: absolute;
    top: clamp(6px, calc(10px * var(--ui-scale)), 10px);
    left: clamp(6px, calc(10px * var(--ui-scale)), 10px);
    width: clamp(32px, calc(96px * var(--ui-scale)), 96px);
    height: clamp(32px, calc(96px * var(--ui-scale)), 96px);
    border-radius: 8px;
    overflow: hidden;
    border: 1px solid rgba(255,255,255,0.35);
    background: rgba(0,0,0,0.35);
}
#player-avatar img {
    width: 100%;
    height: 100%;
    display: block;
    image-rendering: pixelated;
}

.char-confirm { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.5); z-index: 50; }
/* 角色確認對話框：共用面板背景/邊框/陰影，維持原尺寸 */
.char-dialog { width: min(480px, 92vw); background: var(--panel-bg); border: var(--border-soft); border-radius: 12px; padding: 16px; box-shadow: var(--shadow-lg); }
.char-dialog-title { font-size: 1.4rem; margin-bottom: 6px; }
.char-dialog-desc { color: #cfe7ff; margin-bottom: 12px; }
.char-dialog-actions { display: flex; gap: 10px; justify-content: flex-end; }


/* 技能頁（ESC） */
/* 技能頁面面板：採用共用面板背景/邊框/陰影，維持原尺寸 */
#skills-menu {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: min(600px, 92vw);
    max-height: 70vh;
    padding: 16px;
    background: var(--panel-bg);
    border: var(--border-soft);
    border-radius: 12px;
    box-shadow: var(--shadow-lg);
    backdrop-filter: blur(6px);
    z-index: 120;
}
.skills-title { font-size: 1.6rem; font-weight: 700; margin-bottom: 8px; text-align: center; }
.skills-list { display: grid; grid-template-columns: 1fr 60px; row-gap: 6px; column-gap: 12px; align-items: center; margin-bottom: 12px; }
.skill-item { display: contents; }
.skill-name { color: #fff; }
.skill-level { color: #9ed0ff; text-align: right; }
.skill-empty { text-align: center; color: #cfe7ff; padding: 6px 0; }
.skills-volume { border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; }
.skills-hint { margin-top: 8px; text-align: center; color: #aaa; font-size: 0.9rem; }

/* 重複定義移除：選圖/難度選擇區塊尾端版本（保留前段唯一版本） */

/* 重複定義移除：.top-left-icon-btn 已在前段合併 */

/* Mobile-only adjustments for top-left icon (higher specificity, no PC impact) */
@media (max-width: 900px) {
  #character-select-screen .top-left-icon-btn,
  #talent-select-screen .top-left-icon-btn { width: 80px; top: 8px; left: 8px; }
}
@media (max-width: 700px) {
  #character-select-screen .top-left-icon-btn,
  #talent-select-screen .top-left-icon-btn { width: 72px; top: 6px; left: 6px; }
}
@media (max-width: 480px) {
  #character-select-screen .top-left-icon-btn,
  #talent-select-screen .top-left-icon-btn { width: 60px; top: 4px; left: 4px; }
}

/* 天賦介面：補上最底層背景 background2.jpg */
/* 天賦選擇畫面背景：與角色畫面一致的遮罩漸層與背景圖 */
/* ANCHOR: TALENT-SELECT — 極高風險區塊（禁止刪除/搬移/重構）
 * - 僅於 `#talent-select-screen` 命名空間內覆蓋；禁止改動或刪除既有樣式。
 * - 高風險選擇器：`.talent-grid`、`.char-card`、`.char-card-wrap`、`.top-left-icon-btn`（RWD限定）。
 * - 不改文字/文案：卡片名稱、描述、提示不可更動；本區僅視覺。
 * - 行為一致：不得更動排版結構（格數、定位、RWD斷點）；若需調整，請以子選擇器覆蓋小範圍。
 * - SaveCode 提醒：CSS不得影響存檔；任何涉及資料呈現的變動應交由 JS，CSS 僅跟隨。
 */
#talent-select-screen {
  background:
    var(--overlay-grad),
    url('../assets/images/background2.jpg') center/cover no-repeat;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  touch-action: pan-y;
  scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none; /* IE/Edge */
}
#talent-select-screen::-webkit-scrollbar { width: 0; height: 0; }
#talent-select-screen .char-card-wrap {
  scrollbar-width: none;
  -ms-overflow-style: none;
}
#talent-select-screen .char-card-wrap::-webkit-scrollbar { width: 0; height: 0; }

/* 引繼碼介面背景：與開始/選角/天賦一致的遮罩與底圖 */
/* ANCHOR: BACKUP-SCREEN — SaveCode 介面視覺（禁止改動存檔邏輯）
 * - 僅視覺：不得更動輸入框/文字內容/按鈕文案；避免影響使用者引繼操作。
 * - SaveCode 安全守門：CSS 不得牽動 `localStorage` 鍵名、資料結構或簽章；任何更動由 JS 另行升版並保持向下相容。
 * - 視覺調整請在本命名空間內覆蓋，避免跨畫面污染。
 */
#backup-screen {
  background:
    var(--overlay-grad),
    url('../assets/images/background2.jpg') center/cover no-repeat;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  touch-action: pan-y;
}
/* 引繼碼內框：半透明面板疊加 Background3/background3 */
/* ANCHOR: SELECT-CARD — 覆蓋視窗通用卡片（選圖/難度/引繼碼）
 * - 通用樣式，易誤觸：避免全域大改；如需差異樣式，請用父畫面命名空間覆蓋（例如 `#map-select-screen .select-card`）。
 * - 不改文字：標題、副文案、按鈕文案不可更動。
 */
#backup-screen .select-card {
  background:
    var(--panel-grad),
    url('../assets/images/Background3.jpg') center/cover no-repeat,
    url('../assets/images/background3.jpg') center/cover no-repeat;
}

/* 重複定義移除：.talent-grid（含 RWD）已在前段統一保留 */

/* 天賦鎖定狀態 */
.char-card.locked {
  opacity: 0.8;
}
.char-card.locked .grayscale {
  filter: grayscale(100%);
}

/* 重複定義移除：#talent-confirm 與 .talent-dialog 已在前段保留唯一版本 */

/* 天賦介面金幣顯示：移到內框右上 */
#talent-select-screen .char-card-wrap { position: relative; }
#talent-coins {
  position: absolute;
  top: 12px;
  right: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
  z-index: 10;
}
#talent-coins-icon {
  width: 28px;
  height: 28px;
  image-rendering: pixelated;
  display: block;
}
#talent-coins-text {
  padding: 4px 8px;
  border: 2px solid #fff;
  border-radius: 6px;
  color: #fff;
  background: transparent;
  font-weight: 700;
  line-height: 1;
}


/* Talent select screen overrides */
#talent-select-screen .talent-grid {
  grid-template-columns: repeat(6, minmax(0, 1fr));
  grid-auto-rows: auto;
  justify-items: stretch;
}
#talent-select-screen .char-card,
#talent-select-screen .char-slot {
  aspect-ratio: 1 / 1;
  padding: 0;
  overflow: hidden;
}
#talent-select-screen .char-card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  image-rendering: pixelated;
  display: block;
}
#talent-select-screen .char-name { display: none; }

@media (max-width: 900px) {
  #talent-select-screen .talent-grid { grid-template-columns: repeat(4, minmax(0, 1fr)); }
}
@media (max-width: 700px) {
  #talent-select-screen .talent-grid { grid-template-columns: repeat(3, minmax(0, 1fr)); }
}
@media (max-width: 480px) {
  #talent-select-screen .talent-grid { grid-template-columns: repeat(4, minmax(0, 1fr)); }
}

.char-preview { margin-top: 18px; display: grid; grid-template-columns: 220px 1fr; gap: 16px; align-items: center; }
.char-preview-image img { width: 100%; height: auto; image-rendering: pixelated; border-radius: 8px; border: 1px solid rgba(255,255,255,0.15); }
.char-preview-name { font-size: 1.2rem; font-weight: 700; margin-bottom: 8px; }
.char-preview-desc { color: #cfe7ff; margin-bottom: 8px; }
.char-hint { color: #9ed0ff; font-size: .95rem; }

/* 響應式：調整選角介面在窄螢幕下的排版 */
@media (max-width: 900px) {
  .char-grid { grid-template-columns: repeat(4, minmax(140px, 1fr)); grid-auto-rows: 140px; }
  .char-card img { width: 88px; height: 88px; }
  .char-preview { grid-template-columns: 200px 1fr; }
}
@media (max-width: 700px) {
  .char-grid { grid-template-columns: repeat(3, minmax(120px, 1fr)); grid-auto-rows: 120px; }
  .char-card img { width: 80px; height: 80px; }
  .char-preview { grid-template-columns: 1fr; }
}
@media (max-width: 480px) {
  .char-grid { grid-template-columns: repeat(4, minmax(120px, 1fr)); grid-auto-rows: 120px; }
  .char-card-wrap { width: 95vw; padding: 14px; }
}

/* 重複定義移除：#player-avatar 與 .char-dialog 尾段版本 */


/* 重複定義移除：#skills-menu 與其子項已在前段以共用變數合併 */

/* 選圖/難度選擇 */
/* ANCHOR: SELECT-CARD — 通用選擇卡片（避免全域覆蓋）
 * - 此為選圖/難度等通用卡片容器，少改動全域樣式。
 * - 需差異時，僅在父命名空間覆蓋：
 *   `#map-select-screen .select-card`、`#difficulty-select-screen .select-card`。
 * - 不改文字：標題、副標、描述文案不可更動。
 */
.select-card {
    position: relative;
    width: min(900px, 92vw);
    max-height: 92vh;
    padding: 24px;
    border-radius: 12px;
    background: rgba(20, 20, 20, 0.85);
    box-shadow: 0 12px 40px rgba(0,0,0,0.6);
    backdrop-filter: blur(6px);
    overflow: auto;
}
.select-title {
    font-size: 1.8rem;
    margin-bottom: 12px;
    text-align: center;
    color: #fff;
}
/* ANCHOR: MAP-GRID — 地圖選擇版面（避免全域覆蓋）
 * - 僅於 `#map-select-screen` 命名空間覆蓋需要的差異；本通用格子請少改。
 * - 不改文字：地圖名稱/介紹不可更動。
 */
.map-grid {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 12px;
    width: 100%;
}
.map-card {
    background: #222;
    border: 2px solid #555;
    border-radius: 8px;
    overflow: hidden;
    cursor: pointer;
    pointer-events: auto;
    transition: all 0.15s;
}
.map-card img {
    width: 100%;
    height: 120px;
    object-fit: cover;
    display: block;
}
.map-name {
    padding: 8px;
    text-align: center;
    font-weight: bold;
    color: #fff;
}
.select-actions {
    margin-top: 12px;
    display: flex;
    justify-content: flex-end;
    gap: 8px;
}
/* ANCHOR: DIFF-GRID — 難度選擇版面（避免全域覆蓋）
 * - 僅於 `#difficulty-select-screen` 命名空間覆蓋需要的差異；本通用格子請少改。
 * - 不改文字：難度按鈕文案不可更動。
 */
.diff-grid {
    display: flex;
    gap: 12px;
    justify-content: center;
}
.diff-card {
    background: #222;
    border: 2px solid #ff0000;
    border-radius: 8px;
    padding: 12px 16px;
    cursor: pointer;
    pointer-events: auto;
    font-weight: bold;
    transition: all 0.15s;
    color: #fff;
    font-size: 2rem;
}
.diff-card:hover, .map-card:hover {
    filter: brightness(1.1);
    transform: translateY(-1px);
}

@media (max-width: 640px) {
    .map-card img { height: 90px; }
    .select-card { padding: 16px; }
}
.map-desc { margin-top: 10px; color: #cfe7ff; text-align: center; }
.map-card.disabled { cursor: not-allowed; opacity: 0.6; }

/* 左上角圖示按鈕（透明、與標題同高度靠左） */
/* ANCHOR: TOP-LEFT-ICON-BTN — 通用角落圖示（RWD限定調整）
 * - 僅針對手機版RWD調整尺寸與位置；避免PC全域覆蓋。
 * - 若需畫面差異，請使用父命名空間覆蓋，例如 `#talent-select-screen .top-left-icon-btn`。
 * - 不改文字與行為：此區僅視覺，不改動文字/功能。
 */
.top-left-icon-btn {
  position: absolute;
  top: 24px;
  left: 24px;
  width: 120px;
  height: auto;
  padding: 0;
  border: none;
  background: transparent;
  cursor: pointer;
  pointer-events: auto;
  z-index: 10;
}
.top-left-icon-btn img {
  width: 100%;
  height: 100%;
  display: block;
  image-rendering: pixelated;
}
.top-left-icon-btn:hover { transform: scale(1.03); }

/* 重複定義移除：#talent-select-screen 背景已在前段以 var(--overlay-grad) 合併 */

/* ANCHOR: TALENT-GRID — 天賦通用網格（極高風險，命名空間覆蓋）
 * - 僅於 `#talent-select-screen .talent-grid` 或父命名空間做差異覆蓋；通用樣式請少改。
 * - 不改文字/圖示代號：避免影響天賦文案與視覺標識。
 */
/* 天賦格子：每行 6 格（總 12 格 = 2 行） */
.talent-grid {
  display: grid;
  grid-template-columns: repeat(6, minmax(120px, 1fr));
  grid-auto-rows: 120px;
  gap: 14px;
  justify-items: center;
}
.talent-grid .char-card img {
  width: 80px;
  height: 80px;
}

@media (max-width: 900px) {
  .talent-grid { grid-template-columns: repeat(4, minmax(110px, 1fr)); grid-auto-rows: 110px; }
}
@media (max-width: 640px) {
  .talent-grid { grid-template-columns: repeat(3, minmax(100px, 1fr)); grid-auto-rows: 100px; }
}
@media (max-width: 420px) {
  .talent-grid { grid-template-columns: repeat(2, minmax(100px, 1fr)); grid-auto-rows: 100px; }
}

/* 天賦鎖定狀態 */
.char-card.locked {
  opacity: 0.8;
}
.char-card.locked .grayscale {
  filter: grayscale(100%);
}

/* 天賦解鎖確認彈窗 */
#talent-confirm {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}
#talent-confirm.hidden {
  display: none;
}
.talent-dialog {
  background: #1a2a3a;
  border: 2px solid #4a90e2;
  border-radius: 8px;
  padding: 20px;
  width: 80%;
  max-width: 400px;
  text-align: center;
}
.talent-dialog-title {
  font-size: 1.5rem;
  margin-bottom: 10px;
  color: #fff;
}
.talent-dialog-desc {
  margin-bottom: 20px;
  color: #ccc;
}
.talent-dialog-actions {
  display: flex;
  justify-content: center;
  gap: 10px;
}

