/* 全局設定 */
body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; }
canvas { display: block; cursor: none; }

/* UI 層 */
#ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
.hud-text { position: absolute; color: white; text-shadow: 2px 2px 0 #000; font-weight: bold; font-family: monospace; font-size: 16px; }

/* 資訊列 */
#fps-counter { top: 10px; left: 10px; }
#coords { top: 30px; left: 10px; font-size: 12px; color: #ccc; }

/* 白天/夜晚顯示 (中間最上方) */
#daynight-display {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    color: white;
    font-family: monospace;
    font-size: 18px;
    font-weight: bold;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
    z-index: 10;
}

/* 資訊容器 (座標、錢幣、防禦力) */
#info-container {
    position: absolute;
    top: 30px;
    left: 10px;
    color: white;
    font-family: monospace;
    font-size: 14px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
    line-height: 1.5;
}

/* Buff容器 (左上，在信息容器下方，确保不重叠) */
#buff-container {
    position: absolute;
    top: 75px;
    left: 10px;
    color: #ffcc80;
    font-family: monospace;
    font-size: 14px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
    z-index: 10;
    min-height: 20px;
}

/* 生命值 */
#hearts-container {
    position: absolute; top: 100px; left: 10px; display: flex; gap: 5px;
    z-index: 10;
}

/* 魔力容器 (移到左上，在生命值下方) */
#mana-container {
    position: absolute;
    top: 130px;
    left: 10px;
    display: flex;
    flex-direction: row;
    gap: 2px;
    z-index: 10;
}
#mana-container div {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    border: 2px solid #fff;
    background-color: #555;
}
#mana-container div[style*="background-color: rgb(41, 121, 255)"] {
    background-color: #2979ff !important;
}
.heart {
    width: 20px; height: 20px; background-color: #f44336;
    display: inline-block; transform: rotate(-45deg); position: relative;
    box-shadow: 1px 1px 2px rgba(0,0,0,0.5);
}
.heart::before, .heart::after {
    content: ""; width: 20px; height: 20px; background-color: #f44336;
    border-radius: 50%; position: absolute;
}
.heart::before { top: -10px; left: 0; } .heart::after { top: 0; left: 10px; }
.heart.lost { background-color: #555; } .heart.lost::before, .heart.lost::after { background-color: #555; }

/* 存檔提示 */
#save-msg {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.8); color: #4caf50; padding: 20px;
    border-radius: 10px; font-size: 24px; font-weight: bold;
    display: none; z-index: 200; border: 2px solid #fff;
}

/* 教學 */
#tutorial {
    top: 10px; right: 10px; background: rgba(0, 0, 0, 0.5);
    padding: 10px; border-radius: 5px; font-size: 14px; line-height: 1.5;
    text-align: right; color: #eee;
}

/* 物品欄 */
#hotbar-container {
    position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
    display: flex; gap: 4px; padding: 4px; background: rgba(0,0,0,0.7);
    border: 2px solid #5d4037; border-radius: 4px; pointer-events: auto;
}
.slot {
    width: 40px; height: 40px; border: 2px solid #888; background: rgba(0,0,0,0.5);
    display: flex; align-items: center; justify-content: center; position: relative;
    image-rendering: pixelated; transition: transform 0.1s; cursor: pointer;
}
.slot.active { border-color: #ffca28; transform: scale(1.1); z-index: 10; background: rgba(255, 202, 40, 0.2); }
.slot canvas { width: 32px; height: 32px; }
.slot .count { position: absolute; bottom: 2px; right: 2px; font-size: 10px; color: white; text-shadow: 1px 1px 0 #000; }

/* --- 網格合成選單 (修復預設顯示問題) --- */
#crafting-menu {
    display: none; /* 關鍵：預設隱藏 */
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    background: #1a1a1a; border: 2px solid #5d4037; border-radius: 8px;
    width: 500px; height: 380px; color: white;
    box-shadow: 0 0 20px rgba(0,0,0,0.8); pointer-events: auto; z-index: 100;
    flex-direction: column; /* 設為 column，等 JS 改為 display: flex 時生效 */
}

.crafting-tabs { display: flex; border-bottom: 2px solid #333; background: #222; }
.tab {
    flex: 1; padding: 10px; text-align: center; cursor: pointer;
    background: #333; color: #888; font-weight: bold; border-right: 1px solid #444;
}
.tab:hover { background: #444; }
.tab.active { background: #1a1a1a; color: #ffca28; border-bottom: 2px solid #1a1a1a; margin-bottom: -2px; }

.crafting-body { display: flex; flex: 1; overflow: hidden; }

#recipe-grid {
    flex: 2; padding: 10px; display: grid;
    grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
    grid-auto-rows: 40px; gap: 5px; overflow-y: auto; border-right: 2px solid #333;
}

.recipe-slot {
    width: 40px; height: 40px; border: 2px solid #555; background: rgba(255,255,255,0.05);
    display: flex; align-items: center; justify-content: center; cursor: pointer; image-rendering: pixelated;
}
.recipe-slot:hover { border-color: #fff; background: rgba(255,255,255,0.1); }
.recipe-slot.selected { border-color: #ffca28; background: rgba(255, 202, 40, 0.2); }
.recipe-slot.cannot-craft { opacity: 0.3; filter: grayscale(100%); }

#recipe-details {
    flex: 1.2; padding: 15px; display: flex; flex-direction: column;
    align-items: center; background: #222;
}
#detail-icon {
    width: 64px; height: 64px; border: 2px solid #555; background: rgba(0,0,0,0.3);
    margin-bottom: 10px; display: flex; align-items: center; justify-content: center;
}
#detail-icon canvas { width: 48px; height: 48px; image-rendering: pixelated; }
#detail-name { margin: 5px 0; font-size: 18px; color: #ffca28; text-align: center; }
#detail-cost { flex: 1; width: 100%; margin-top: 10px; font-size: 14px; color: #ccc; line-height: 1.6; }
.cost-item { display: flex; justify-content: space-between; }
.cost-item.missing { color: #ff5252; }

#craft-btn {
    width: 100%; padding: 10px; background: #4caf50; color: white;
    border: none; border-radius: 4px; cursor: pointer; font-size: 16px; font-weight: bold;
}
#craft-btn:disabled { background: #555; cursor: not-allowed; }
#craft-btn:hover:not(:disabled) { background: #66bb6a; }

/* 載入畫面 */
#loading {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: #222; color: #fff; display: flex; flex-direction: column;
    align-items: center; justify-content: center; z-index: 999;
}
.progress-bar { width: 300px; height: 20px; background: #444; border: 2px solid #fff; margin-top: 20px; }
.progress-fill { height: 100%; background: #4caf50; width: 0%; transition: width 0.2s; }

/* --- 箱子介面 --- */
#chest-menu {
    display: none;
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: #1a1a1a;
    border: 3px solid #ffb300; /* 金色邊框區分 */
    border-radius: 8px;
    width: 300px;
    padding: 15px;
    color: white;
    box-shadow: 0 0 20px rgba(0,0,0,0.9);
    pointer-events: auto;
    z-index: 101; /* 比合成選單高 */
    flex-direction: column;
    align-items: center;
}

#chest-menu h3 { 
    margin: 0 0 15px 0; 
    border-bottom: 1px solid #555; 
    width: 100%; 
    text-align: center; 
    padding-bottom: 5px;
}

#chest-grid {
    display: grid;
    grid-template-columns: repeat(5, 40px); /* 5 欄 */
    gap: 8px;
    margin-bottom: 10px;
}

#chest-menu .hint { 
    font-size: 12px; 
    color: #888; 
    margin-top: 5px;
}

/* --- 商人購買介面 --- */
#merchant-menu {
    display: none;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #1a1a1a;
    border: 3px solid #795548; /* 棕色邊框 */
    border-radius: 8px;
    width: 500px;
    padding: 15px;
    color: white;
    box-shadow: 0 0 20px rgba(0,0,0,0.9);
    pointer-events: auto;
    z-index: 102; /* 比箱子介面高 */
    flex-direction: column;
}

#merchant-menu h3 {
    margin: 0 0 15px 0;
    border-bottom: 1px solid #555;
    width: 100%;
    text-align: center;
    padding-bottom: 5px;
    color: #ffd700;
}

#merchant-grid {
    display: grid;
    grid-template-columns: repeat(3, 40px);
    gap: 5px;
    margin-bottom: 15px;
    justify-content: center;
}

#merchant-details {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px;
    background: #222;
    border-radius: 5px;
    margin-bottom: 10px;
}

#merchant-icon {
    width: 64px;
    height: 64px;
    border: 2px solid #555;
    background: rgba(0,0,0,0.3);
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
}

#merchant-icon canvas {
    width: 48px;
    height: 48px;
    image-rendering: pixelated;
}

#merchant-name {
    margin: 5px 0;
    font-size: 18px;
    color: #ffca28;
    text-align: center;
}

#merchant-desc {
    margin: 5px 0;
    font-size: 14px;
    color: #ccc;
    text-align: center;
}

#merchant-price {
    margin: 5px 0;
    font-size: 16px;
    color: #ffd700;
    font-weight: bold;
}

#merchant-buy-btn {
    width: 100%;
    padding: 10px;
    background: #4caf50;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    margin-top: 10px;
}

#merchant-buy-btn:disabled {
    background: #555;
    cursor: not-allowed;
}

#merchant-buy-btn:hover:not(:disabled) {
    background: #66bb6a;
}

#merchant-menu .hint {
    font-size: 12px;
    color: #888;
    margin-top: 5px;
    text-align: center;
}